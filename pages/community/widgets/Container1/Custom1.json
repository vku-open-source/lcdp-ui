{
  "backgroundColor": "#ffffff",
  "borderColor": "#ffffff",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "1",
  "bottomRow": 93,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "defaultModel": "{{getAllcommunity.data }}",
  "dynamicBindingPathList": [
    {
      "key": "theme"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "defaultModel"
    }
  ],
  "dynamicHeight": "FIXED",
  "dynamicPropertyPathList": [],
  "dynamicTriggerPathList": [
    {
      "key": "navigateToPostForm"
    }
  ],
  "events": [
    "navigateToPostForm"
  ],
  "isCanvas": false,
  "isLoading": false,
  "isSearchWildcard": true,
  "isVisible": true,
  "key": "wy4giwctor",
  "leftColumn": 0,
  "maxDynamicHeight": 9000,
  "minDynamicHeight": 4,
  "mobileBottomRow": 39,
  "mobileLeftColumn": 9,
  "mobileRightColumn": 32,
  "mobileTopRow": 9,
  "navigateToPostForm": "{{navigateTo('post_community_form', {}, 'SAME_WINDOW');}}",
  "needsErrorInfo": false,
  "parentColumnSpace": 20.125,
  "parentId": "sdbe7q9nm8",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "rightColumn": 64,
  "srcDoc": {
    "css": "@charset \"UTF-8\";\n.app {\n  height: calc(var(--appsmith-ui-height) * 1px);\n  width: calc(var(--appsmith-ui-width) * 1px);\n  display: flex;\n  flex-direction: column;\n  padding: 20px;\n  background-color: #ffffff;\n  align-items: center; /* Căn giữa nội dung */\n}\n\nh2 {\n  text-align: center;\n  margin-bottom: 20px; /* Tạo khoảng cách dưới tiêu đề */\n}\n\n.search-container {\n  margin-bottom: 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%; /* Đảm bảo khung tìm kiếm chiếm toàn bộ chiều rộng */\n}\n\n.search-container input {\n  width: 20%;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 10px;\n  font-size: 14px;\n}\n\n.filter-container {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.filter-container select,\n.filter-container input {\n  margin-right: 10px;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.post-card {\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  margin-bottom: 15px;\n  padding: 15px;\n  transition: transform 0.2s;\n  width: 80%; /* Đảm bảo thẻ bài đăng chiếm toàn bộ chiều rộng */\n}\n\n.post-card:hover {\n  transform: scale(1.02);\n}\n\n.post-title {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 10px;\n  color: #333;\n}\n\n.post-content {\n  font-size: 14px;\n  color: #555;\n}\n\n.post-footer {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 10px;\n  color: #999;\n}\n\n.post-type {\n  font-size: 12px;\n  margin-top: 5px;\n}\n\n.type-evacuation_guide,\n.type-first_aid_guide,\n.type-safety_guide {\n  color: #28a745; /* Màu xanh lá */\n}\n\n.type-emergency_alert {\n  color: #dc3545; /* Màu đỏ */\n}\n\n.button-container {\n  text-align: right;\n}\n\n.button-container button {\n  margin: 0 10px;\n  border-radius: var(--appsmith-theme-borderRadius);\n}\n\n.button-container button.primary {\n  background: var(--appsmith-theme-primaryColor) !important;\n}\n\nbody {\n  background-color: #f7f9fc; /* Màu nền nhẹ cho toàn bộ trang */\n  font-family: Arial, sans-serif; /* Font chữ dễ đọc */\n}\n\n.post-detail {\n  padding: 20px;\n  background: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  max-width: 800px; /* Tăng chiều rộng tối đa */\n  margin: 20px auto; /* Căn giữa */\n  position: relative; /* Để nút Back có thể được định vị */\n}\n\n.post-card {\n  padding: 20px;\n  border: none; /* Bỏ viền cho card */\n  margin-bottom: 20px;\n}\n\nh2 {\n  margin-bottom: 20px;\n  text-align: center; /* Căn giữa tiêu đề */\n}\n\nstrong {\n  color: #333; /* Màu cho các nhãn */\n}\n\n.post-footer {\n  margin-top: 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.notification-channels {\n  margin-top: 10px;\n}\n\n.notification-channels button {\n  margin: 5px;\n}\n\nbutton {\n  cursor: pointer;\n}\n\np {\n  line-height: 1.6; /* Tăng khoảng cách giữa các dòng */\n  margin: 10px 0; /* Tạo khoảng cách giữa các đoạn */\n}\n\n.delete-post-button {\n  background-color: red; /* Màu nền đỏ */\n  border-color: red; /* Màu viền đỏ */\n  color: white; /* Màu chữ trắng */\n}",
    "html": "<!-- Không cần <html>, <head>, <body> do Appsmith đã có sẵn -->\n<div id=\"root\"></div>\n",
    "js": "appsmith.onReady(() => {\n  // Biến toàn cục\n  let allPosts = []; // Mảng lưu toàn bộ post từ API\n  let searchTerm = \"\"; // Từ khoá tìm kiếm\n  let selectedType = \"all\"; // Lọc theo type\n  let selectedPriority = \"all\"; // Lọc theo priority\n  let startDate = \"\";\n  let endDate = \"\";\n  let sortOrder = \"asc\"; // 'asc' hoặc 'desc'\n  let selectedPost = null; // Nếu != null => đang xem chi tiết 1 post\n\n  const root = document.getElementById(\"root\");\n  if (!root) {\n    console.error(\"No #root element found!\");\n    return;\n  }\n\n  // 1) Gọi API lấy data\n  async function fetchPosts() {\n    try {\n      const response = await fetch(\"http://tap.sigconn.sbs:1337/api/communities?filters[type][$ne]=emergency_alert&populate=*\");\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch posts\");\n      }\n      const json = await response.json(); // { data: [...], meta: {...} }\n      allPosts = json.data || [];\n      renderMainView(); // Render lần đầu sau khi load xong\n    } catch (err) {\n      console.error(err);\n      // Tuỳ bạn xử lý lỗi, ví dụ alert\n      alert(\"Failed to load posts.\");\n    }\n  }\n\n  // 2) Hàm render chính (tuỳ thuộc vào selectedPost)\n  function renderMainView() {\n    if (selectedPost) {\n      renderDetailView(selectedPost);\n    } else {\n      renderListView();\n    }\n  }\n\n  // 3) Render danh sách + bộ lọc\n  function renderListView() {\n    // Tạo HTML cho bộ lọc + danh sách\n    const html = `\n      <div class=\"app\">\n        <h2>Cộng Đồng Hướng Dẫn Ứng Phó Khẩn Cấp</h2>\n\n        <!-- Search -->\n        <div class=\"search-container\">\n          <input \n            type=\"text\" \n            placeholder=\"Search posts...\" \n            value=\"${searchTerm}\"\n            id=\"searchInput\"\n            style=\"margin-right: 10px;\"\n          />\n        </div>\n\n        <!-- Filter -->\n        <div class=\"filter-container\">\n          <select id=\"typeSelect\">\n            <option value=\"all\" ${selectedType === \"all\" ? \"selected\" : \"\"}>All Types</option>\n            <option value=\"evacuation_guide\" ${selectedType === \"evacuation_guide\" ? \"selected\" : \"\"}>Evacuation Guide</option>\n            <option value=\"first_aid_guide\" ${selectedType === \"first_aid_guide\" ? \"selected\" : \"\"}>First Aid Guide</option>\n            <option value=\"safety_guide\" ${selectedType === \"safety_guide\" ? \"selected\" : \"\"}>Safety Guide</option>\n          </select>\n\n          <select id=\"prioritySelect\">\n            <option value=\"all\" ${selectedPriority === \"all\" ? \"selected\" : \"\"}>All Priorities</option>\n            <option value=\"high\" ${selectedPriority === \"high\" ? \"selected\" : \"\"}>High</option>\n            <option value=\"medium\" ${selectedPriority === \"medium\" ? \"selected\" : \"\"}>Medium</option>\n            <option value=\"low\" ${selectedPriority === \"low\" ? \"selected\" : \"\"}>Low</option>\n            <option value=\"urgent\" ${selectedPriority === \"urgent\" ? \"selected\" : \"\"}>Urgent</option>\n          </select>\n\n          <input \n            type=\"date\" \n            id=\"startDateInput\"\n            value=\"${startDate}\"\n            style=\"width: 150px;\"\n          />\n          <input \n            type=\"date\" \n            id=\"endDateInput\"\n            value=\"${endDate}\"\n            style=\"width: 150px;\"\n          />\n\n          <select id=\"sortSelect\">\n            <option value=\"asc\" ${sortOrder === \"asc\" ? \"selected\" : \"\"}>Sort by Date (Asc)</option>\n            <option value=\"desc\" ${sortOrder === \"desc\" ? \"selected\" : \"\"}>Sort by Date (Desc)</option>\n          </select>\n        </div>\n\n        <!-- Nút Cảnh báo -->\n        <div style=\"text-align: center; margin-top: 20px; margin-bottom: 20px;\">\n          <button id=\"alertBtn\" style=\"background: red; color: #fff; padding: 8px 16px; border: none; border-radius: 4px;\">\n            Cảnh báo Cộng Đồng\n          </button>\n        </div>\n\n        <!-- Danh sách posts -->\n        <div id=\"postListContainer\">\n          ${renderPostListHTML()}\n        </div>\n      </div>\n    `;\n    root.innerHTML = html;\n\n    // Gắn event listener cho filter\n    document.getElementById(\"searchInput\").addEventListener(\"input\", e => {\n      searchTerm = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"typeSelect\").addEventListener(\"change\", e => {\n      selectedType = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"prioritySelect\").addEventListener(\"change\", e => {\n      selectedPriority = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"startDateInput\").addEventListener(\"change\", e => {\n      startDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"endDateInput\").addEventListener(\"change\", e => {\n      endDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"sortSelect\").addEventListener(\"change\", e => {\n      sortOrder = e.target.value;\n      renderMainView();\n    });\n\n    // Nút Cảnh báo\n    document.getElementById(\"alertBtn\").addEventListener(\"click\", () => {\n      appsmith.triggerEvent(\"navigateToPostForm\");\n    });\n  }\n\n  // 4) Tạo HTML cho danh sách post (có filter, sort)\n  function renderPostListHTML() {\n    // Lọc\n    let filtered = allPosts.filter(post => {\n      const title = post.title?.toLowerCase() || \"\";\n      const matchesSearch = title.includes(searchTerm.toLowerCase());\n      const matchesType = selectedType === \"all\" || post.type === selectedType;\n      const matchesPriority = selectedPriority === \"all\" || post.priority === selectedPriority;\n\n      // Lọc theo ngày\n      const createdDate = new Date(post.createdAt);\n      if (startDate && createdDate < new Date(startDate)) return false;\n      if (endDate && createdDate > new Date(endDate)) return false;\n      return matchesSearch && matchesType && matchesPriority;\n    });\n\n    // Sắp xếp\n    filtered.sort((a, b) => {\n      const dateA = new Date(a.createdAt);\n      const dateB = new Date(b.createdAt);\n      return sortOrder === \"asc\" ? dateA - dateB : dateB - dateA;\n    });\n\n    // Tạo HTML\n    let html = \"\";\n    filtered.forEach(post => {\n      html += `\n        <div class=\"post-card\">\n          <div class=\"post-title\">${post.title || \"\"}</div>\n          <div class=\"post-content\">${post.content || \"\"}</div>\n          ${post.attachments && post.attachments.length > 0 ? renderAttachments(post.attachments) : \"\"}\n          <div class=\"post-footer\">\n            <span>${new Date(post.createdAt).toLocaleDateString()}</span>\n            <span class=\"post-type type-${post.type}\">\n              ${post.type?.replace(\"_\", \" \")}\n            </span>\n            <button class=\"detailsBtn\" data-id=\"${post.id}\" style=\"background: none; border: none; color: blue; cursor: pointer;\">\n              Details\n            </button>\n          </div>\n        </div>\n      `;\n    });\n\n    // Nếu rỗng => hiển thị \"No posts found\"\n    if (filtered.length === 0) {\n      html = `<p>No posts found.</p>`;\n    }\n    return html;\n  }\n\n  // 5) Render attachments (ảnh)\n  function renderAttachments(attachments) {\n    let imgs = attachments.map(att => {\n      const url = `http://tap.sigconn.sbs:1337${att.formats?.medium?.url || att.url}`;\n      return `\n          <img\n            src=\"${url}\"\n            alt=\"${att.name || \"Attachment\"}\"\n            style=\"width: 100%; max-height: 400px; object-fit: cover; margin-bottom: 10px; margin-top: 20px;\"\n          />\n        `;\n    }).join(\"\");\n    return `<div class=\"post-images\">${imgs}</div>`;\n  }\n\n  // 6) Render chi tiết 1 post\n  function renderDetailView(post) {\n    const html = `\n      <div class=\"post-detail\">\n        <button id=\"backBtn\" style=\"position: absolute; top: 20px; left: 20px; background: none; color: blue; border: none; cursor: pointer;\">\n          Back\n        </button>\n        <h2>Post Details</h2>\n        <p><strong>Title:</strong> ${post.title || \"\"}</p>\n        <p><strong>Content:</strong> ${post.content || \"\"}</p>\n        ${post.attachments && post.attachments.length > 0 ? renderAttachments(post.attachments) : \"\"}\n        <p><strong>Type:</strong> ${post.type?.replace(\"_\", \" \")}</p>\n        <p><strong>Priority:</strong> ${post.priority || \"\"}</p>\n        <p><strong>Created At:</strong> ${new Date(post.createdAt).toLocaleString()}</p>\n        <p><strong>Updated At:</strong> ${new Date(post.updatedAt).toLocaleString()}</p>\n      </div>\n    `;\n    root.innerHTML = html;\n\n    // Nút Back\n    document.getElementById(\"backBtn\").addEventListener(\"click\", () => {\n      selectedPost = null;\n      renderMainView();\n    });\n  }\n\n  // 7) Lắng nghe sự kiện bấm \"Details\"\n  // Ta sẽ dùng event delegation (vì \"Details\" nút được tạo sau)\n  function addDetailsListener() {\n    // Tìm mọi nút .detailsBtn\n    const detailBtns = root.querySelectorAll(\".detailsBtn\");\n    detailBtns.forEach(btn => {\n      btn.addEventListener(\"click\", () => {\n        // Lấy id\n        const postId = btn.getAttribute(\"data-id\");\n        // Tìm post\n        const post = allPosts.find(p => p.id == postId);\n        if (post) {\n          selectedPost = post;\n          renderMainView();\n        }\n      });\n    });\n  }\n\n  // 8) Mỗi lần renderListView xong, ta gắn event listener\n  function renderListView() {\n    // Tạo HTML\n    const html = `\n      <div class=\"app\">\n        <h2>Cộng Đồng Hướng Dẫn Ứng Phó Khẩn Cấp</h2>\n        <!-- ... (phần form filter, list) -->\n        <div class=\"search-container\">\n          <input \n            type=\"text\" \n            placeholder=\"Search posts...\" \n            value=\"${searchTerm}\"\n            id=\"searchInput\"\n          />\n        </div>\n        <div class=\"filter-container\">\n          <select id=\"typeSelect\">\n            <option value=\"all\" ${selectedType === \"all\" ? \"selected\" : \"\"}>All Types</option>\n            <option value=\"evacuation_guide\" ${selectedType === \"evacuation_guide\" ? \"selected\" : \"\"}>Evacuation Guide</option>\n            <option value=\"first_aid_guide\" ${selectedType === \"first_aid_guide\" ? \"selected\" : \"\"}>First Aid Guide</option>\n            <option value=\"safety_guide\" ${selectedType === \"safety_guide\" ? \"selected\" : \"\"}>Safety Guide</option>\n          </select>\n          <select id=\"prioritySelect\">\n            <option value=\"all\" ${selectedPriority === \"all\" ? \"selected\" : \"\"}>All Priorities</option>\n            <option value=\"high\" ${selectedPriority === \"high\" ? \"selected\" : \"\"}>High</option>\n            <option value=\"medium\" ${selectedPriority === \"medium\" ? \"selected\" : \"\"}>Medium</option>\n            <option value=\"low\" ${selectedPriority === \"low\" ? \"selected\" : \"\"}>Low</option>\n            <option value=\"urgent\" ${selectedPriority === \"urgent\" ? \"selected\" : \"\"}>Urgent</option>\n          </select>\n          <input type=\"date\" id=\"startDateInput\" value=\"${startDate}\" />\n          <input type=\"date\" id=\"endDateInput\" value=\"${endDate}\" />\n          <select id=\"sortSelect\">\n            <option value=\"asc\" ${sortOrder === \"asc\" ? \"selected\" : \"\"}>Sort by Date (Asc)</option>\n            <option value=\"desc\" ${sortOrder === \"desc\" ? \"selected\" : \"\"}>Sort by Date (Desc)</option>\n          </select>\n        </div>\n        <div style=\"text-align: center; margin-top: 20px; margin-bottom: 20px;\">\n          <button id=\"alertBtn\" style=\"background: red; color: #fff; padding: 8px 16px; border: none; border-radius: 4px;\">\n            Cảnh báo Cộng Đồng\n          </button>\n        </div>\n        <div id=\"postListContainer\">\n          ${renderPostListHTML()}\n        </div>\n      </div>\n    `;\n    root.innerHTML = html;\n\n    // Gắn event listener\n    document.getElementById(\"searchInput\").addEventListener(\"input\", e => {\n      searchTerm = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"typeSelect\").addEventListener(\"change\", e => {\n      selectedType = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"prioritySelect\").addEventListener(\"change\", e => {\n      selectedPriority = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"startDateInput\").addEventListener(\"change\", e => {\n      startDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"endDateInput\").addEventListener(\"change\", e => {\n      endDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"sortSelect\").addEventListener(\"change\", e => {\n      sortOrder = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"alertBtn\").addEventListener(\"click\", () => {\n      appsmith.triggerEvent(\"navigateToPostForm\");\n    });\n\n    // Gắn listener cho nút Details\n    addDetailsListener();\n  }\n\n  // 9) Gọi fetchPosts\n  fetchPosts();\n});"
  },
  "theme": "{{appsmith.theme}}",
  "topRow": 0,
  "type": "CUSTOM_WIDGET",
  "uncompiledSrcDoc": {
    "css": ".app {\n  height: calc(var(--appsmith-ui-height) * 1px);\n  width: calc(var(--appsmith-ui-width) * 1px);\n  display: flex;\n  flex-direction: column;\n  padding: 20px;\n  background-color: #ffffff;\n  align-items: center; /* Căn giữa nội dung */\n}\n\nh2 {\n  text-align: center;\n  margin-bottom: 20px; /* Tạo khoảng cách dưới tiêu đề */\n}\n\n.search-container {\n  margin-bottom: 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%; /* Đảm bảo khung tìm kiếm chiếm toàn bộ chiều rộng */\n}\n\n.search-container input {\n  width: 20%;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 10px;\n  font-size: 14px;\n}\n\n.filter-container {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.filter-container select,\n.filter-container input {\n  margin-right: 10px;\n  padding: 10px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.post-card {\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  margin-bottom: 15px;\n  padding: 15px;\n  transition: transform 0.2s;\n  width: 80%; /* Đảm bảo thẻ bài đăng chiếm toàn bộ chiều rộng */\n}\n\n.post-card:hover {\n  transform: scale(1.02);\n}\n\n.post-title {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 10px;\n  color: #333;\n}\n\n.post-content {\n  font-size: 14px;\n  color: #555;\n}\n\n.post-footer {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 10px;\n  color: #999;\n}\n\n.post-type {\n  font-size: 12px;\n  margin-top: 5px;\n}\n\n.type-evacuation_guide,\n.type-first_aid_guide,\n.type-safety_guide {\n  color: #28a745; /* Màu xanh lá */\n}\n\n.type-emergency_alert {\n  color: #dc3545; /* Màu đỏ */\n}\n\n.button-container {\n  text-align: right;\n}\n\n.button-container button {\n  margin: 0 10px;\n  border-radius: var(--appsmith-theme-borderRadius);\n}\n\n.button-container button.primary {\n  background: var(--appsmith-theme-primaryColor) !important;\n}\n\nbody {\n  background-color: #f7f9fc; /* Màu nền nhẹ cho toàn bộ trang */\n  font-family: Arial, sans-serif; /* Font chữ dễ đọc */\n}\n\n.post-detail {\n  padding: 20px;\n  background: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  max-width: 800px; /* Tăng chiều rộng tối đa */\n  margin: 20px auto; /* Căn giữa */\n  position: relative; /* Để nút Back có thể được định vị */\n}\n\n.post-card {\n  padding: 20px;\n  border: none; /* Bỏ viền cho card */\n  margin-bottom: 20px;\n}\n\nh2 {\n  margin-bottom: 20px;\n  text-align: center; /* Căn giữa tiêu đề */\n}\n\nstrong {\n  color: #333; /* Màu cho các nhãn */\n}\n\n.post-footer {\n  margin-top: 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.notification-channels {\n  margin-top: 10px;\n}\n\n.notification-channels button {\n  margin: 5px;\n}\n\nbutton {\n  cursor: pointer;\n}\n\np {\n  line-height: 1.6; /* Tăng khoảng cách giữa các dòng */\n  margin: 10px 0; /* Tạo khoảng cách giữa các đoạn */\n}\n\n.delete-post-button {\n  background-color: red; /* Màu nền đỏ */\n  border-color: red; /* Màu viền đỏ */\n  color: white; /* Màu chữ trắng */\n}\n",
    "html": "<!-- Không cần <html>, <head>, <body> do Appsmith đã có sẵn -->\n<div id=\"root\"></div>\n",
    "js": "appsmith.onReady(() => {\n  // Biến toàn cục\n  let allPosts = [];         // Mảng lưu toàn bộ post từ API\n  let searchTerm = \"\";       // Từ khoá tìm kiếm\n  let selectedType = \"all\";  // Lọc theo type\n  let selectedPriority = \"all\"; // Lọc theo priority\n  let startDate = \"\";\n  let endDate = \"\";\n  let sortOrder = \"asc\";     // 'asc' hoặc 'desc'\n  let selectedPost = null;   // Nếu != null => đang xem chi tiết 1 post\n\n  const root = document.getElementById(\"root\");\n  if (!root) {\n    console.error(\"No #root element found!\");\n    return;\n  }\n\n  // 1) Gọi API lấy data\n  async function fetchPosts() {\n    try {\n      const response = await fetch(\n        \"http://tap.sigconn.sbs:1337/api/communities?filters[type][$ne]=emergency_alert&populate=*\"\n      );\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch posts\");\n      }\n      const json = await response.json(); // { data: [...], meta: {...} }\n      allPosts = json.data || [];\n      renderMainView(); // Render lần đầu sau khi load xong\n    } catch (err) {\n      console.error(err);\n      // Tuỳ bạn xử lý lỗi, ví dụ alert\n      alert(\"Failed to load posts.\");\n    }\n  }\n\n  // 2) Hàm render chính (tuỳ thuộc vào selectedPost)\n  function renderMainView() {\n    if (selectedPost) {\n      renderDetailView(selectedPost);\n    } else {\n      renderListView();\n    }\n  }\n\n  // 3) Render danh sách + bộ lọc\n  function renderListView() {\n    // Tạo HTML cho bộ lọc + danh sách\n    const html = `\n      <div class=\"app\">\n        <h2>Cộng Đồng Hướng Dẫn Ứng Phó Khẩn Cấp</h2>\n\n        <!-- Search -->\n        <div class=\"search-container\">\n          <input \n            type=\"text\" \n            placeholder=\"Search posts...\" \n            value=\"${searchTerm}\"\n            id=\"searchInput\"\n            style=\"margin-right: 10px;\"\n          />\n        </div>\n\n        <!-- Filter -->\n        <div class=\"filter-container\">\n          <select id=\"typeSelect\">\n            <option value=\"all\" ${selectedType === \"all\" ? \"selected\" : \"\"}>All Types</option>\n            <option value=\"evacuation_guide\" ${selectedType === \"evacuation_guide\" ? \"selected\" : \"\"}>Evacuation Guide</option>\n            <option value=\"first_aid_guide\" ${selectedType === \"first_aid_guide\" ? \"selected\" : \"\"}>First Aid Guide</option>\n            <option value=\"safety_guide\" ${selectedType === \"safety_guide\" ? \"selected\" : \"\"}>Safety Guide</option>\n          </select>\n\n          <select id=\"prioritySelect\">\n            <option value=\"all\" ${selectedPriority === \"all\" ? \"selected\" : \"\"}>All Priorities</option>\n            <option value=\"high\" ${selectedPriority === \"high\" ? \"selected\" : \"\"}>High</option>\n            <option value=\"medium\" ${selectedPriority === \"medium\" ? \"selected\" : \"\"}>Medium</option>\n            <option value=\"low\" ${selectedPriority === \"low\" ? \"selected\" : \"\"}>Low</option>\n            <option value=\"urgent\" ${selectedPriority === \"urgent\" ? \"selected\" : \"\"}>Urgent</option>\n          </select>\n\n          <input \n            type=\"date\" \n            id=\"startDateInput\"\n            value=\"${startDate}\"\n            style=\"width: 150px;\"\n          />\n          <input \n            type=\"date\" \n            id=\"endDateInput\"\n            value=\"${endDate}\"\n            style=\"width: 150px;\"\n          />\n\n          <select id=\"sortSelect\">\n            <option value=\"asc\" ${sortOrder === \"asc\" ? \"selected\" : \"\"}>Sort by Date (Asc)</option>\n            <option value=\"desc\" ${sortOrder === \"desc\" ? \"selected\" : \"\"}>Sort by Date (Desc)</option>\n          </select>\n        </div>\n\n        <!-- Nút Cảnh báo -->\n        <div style=\"text-align: center; margin-top: 20px; margin-bottom: 20px;\">\n          <button id=\"alertBtn\" style=\"background: red; color: #fff; padding: 8px 16px; border: none; border-radius: 4px;\">\n            Cảnh báo Cộng Đồng\n          </button>\n        </div>\n\n        <!-- Danh sách posts -->\n        <div id=\"postListContainer\">\n          ${renderPostListHTML()}\n        </div>\n      </div>\n    `;\n\n    root.innerHTML = html;\n\n    // Gắn event listener cho filter\n    document.getElementById(\"searchInput\").addEventListener(\"input\", (e) => {\n      searchTerm = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"typeSelect\").addEventListener(\"change\", (e) => {\n      selectedType = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"prioritySelect\").addEventListener(\"change\", (e) => {\n      selectedPriority = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"startDateInput\").addEventListener(\"change\", (e) => {\n      startDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"endDateInput\").addEventListener(\"change\", (e) => {\n      endDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"sortSelect\").addEventListener(\"change\", (e) => {\n      sortOrder = e.target.value;\n      renderMainView();\n    });\n\n    // Nút Cảnh báo\n    document.getElementById(\"alertBtn\").addEventListener(\"click\", () => {\n      appsmith.triggerEvent(\"navigateToPostForm\");\n    });\n  }\n\n  // 4) Tạo HTML cho danh sách post (có filter, sort)\n  function renderPostListHTML() {\n    // Lọc\n    let filtered = allPosts.filter((post) => {\n      const title = post.title?.toLowerCase() || \"\";\n      const matchesSearch = title.includes(searchTerm.toLowerCase());\n\n      const matchesType =\n        selectedType === \"all\" || post.type === selectedType;\n\n      const matchesPriority =\n        selectedPriority === \"all\" || post.priority === selectedPriority;\n\n      // Lọc theo ngày\n      const createdDate = new Date(post.createdAt);\n      if (startDate && createdDate < new Date(startDate)) return false;\n      if (endDate && createdDate > new Date(endDate)) return false;\n\n      return matchesSearch && matchesType && matchesPriority;\n    });\n\n    // Sắp xếp\n    filtered.sort((a, b) => {\n      const dateA = new Date(a.createdAt);\n      const dateB = new Date(b.createdAt);\n      return sortOrder === \"asc\" ? dateA - dateB : dateB - dateA;\n    });\n\n    // Tạo HTML\n    let html = \"\";\n    filtered.forEach((post) => {\n      html += `\n        <div class=\"post-card\">\n          <div class=\"post-title\">${post.title || \"\"}</div>\n          <div class=\"post-content\">${post.content || \"\"}</div>\n          ${\n            post.attachments && post.attachments.length > 0\n              ? renderAttachments(post.attachments)\n              : \"\"\n          }\n          <div class=\"post-footer\">\n            <span>${new Date(post.createdAt).toLocaleDateString()}</span>\n            <span class=\"post-type type-${post.type}\">\n              ${post.type?.replace(\"_\", \" \")}\n            </span>\n            <button class=\"detailsBtn\" data-id=\"${post.id}\" style=\"background: none; border: none; color: blue; cursor: pointer;\">\n              Details\n            </button>\n          </div>\n        </div>\n      `;\n    });\n\n    // Nếu rỗng => hiển thị \"No posts found\"\n    if (filtered.length === 0) {\n      html = `<p>No posts found.</p>`;\n    }\n    return html;\n  }\n\n  // 5) Render attachments (ảnh)\n  function renderAttachments(attachments) {\n    let imgs = attachments\n      .map((att) => {\n        const url = `http://tap.sigconn.sbs:1337${att.formats?.medium?.url || att.url}`;\n        return `\n          <img\n            src=\"${url}\"\n            alt=\"${att.name || \"Attachment\"}\"\n            style=\"width: 100%; max-height: 400px; object-fit: cover; margin-bottom: 10px; margin-top: 20px;\"\n          />\n        `;\n      })\n      .join(\"\");\n    return `<div class=\"post-images\">${imgs}</div>`;\n  }\n\n  // 6) Render chi tiết 1 post\n  function renderDetailView(post) {\n    const html = `\n      <div class=\"post-detail\">\n        <button id=\"backBtn\" style=\"position: absolute; top: 20px; left: 20px; background: none; color: blue; border: none; cursor: pointer;\">\n          Back\n        </button>\n        <h2>Post Details</h2>\n        <p><strong>Title:</strong> ${post.title || \"\"}</p>\n        <p><strong>Content:</strong> ${post.content || \"\"}</p>\n        ${\n          post.attachments && post.attachments.length > 0\n            ? renderAttachments(post.attachments)\n            : \"\"\n        }\n        <p><strong>Type:</strong> ${post.type?.replace(\"_\", \" \")}</p>\n        <p><strong>Priority:</strong> ${post.priority || \"\"}</p>\n        <p><strong>Created At:</strong> ${new Date(post.createdAt).toLocaleString()}</p>\n        <p><strong>Updated At:</strong> ${new Date(post.updatedAt).toLocaleString()}</p>\n      </div>\n    `;\n    root.innerHTML = html;\n\n    // Nút Back\n    document.getElementById(\"backBtn\").addEventListener(\"click\", () => {\n      selectedPost = null;\n      renderMainView();\n    });\n  }\n\n  // 7) Lắng nghe sự kiện bấm \"Details\"\n  // Ta sẽ dùng event delegation (vì \"Details\" nút được tạo sau)\n  function addDetailsListener() {\n    // Tìm mọi nút .detailsBtn\n    const detailBtns = root.querySelectorAll(\".detailsBtn\");\n    detailBtns.forEach((btn) => {\n      btn.addEventListener(\"click\", () => {\n        // Lấy id\n        const postId = btn.getAttribute(\"data-id\");\n        // Tìm post\n        const post = allPosts.find((p) => p.id == postId);\n        if (post) {\n          selectedPost = post;\n          renderMainView();\n        }\n      });\n    });\n  }\n\n  // 8) Mỗi lần renderListView xong, ta gắn event listener\n  function renderListView() {\n    // Tạo HTML\n    const html = `\n      <div class=\"app\">\n        <h2>Cộng Đồng Hướng Dẫn Ứng Phó Khẩn Cấp</h2>\n        <!-- ... (phần form filter, list) -->\n        <div class=\"search-container\">\n          <input \n            type=\"text\" \n            placeholder=\"Search posts...\" \n            value=\"${searchTerm}\"\n            id=\"searchInput\"\n          />\n        </div>\n        <div class=\"filter-container\">\n          <select id=\"typeSelect\">\n            <option value=\"all\" ${selectedType === \"all\" ? \"selected\" : \"\"}>All Types</option>\n            <option value=\"evacuation_guide\" ${selectedType === \"evacuation_guide\" ? \"selected\" : \"\"}>Evacuation Guide</option>\n            <option value=\"first_aid_guide\" ${selectedType === \"first_aid_guide\" ? \"selected\" : \"\"}>First Aid Guide</option>\n            <option value=\"safety_guide\" ${selectedType === \"safety_guide\" ? \"selected\" : \"\"}>Safety Guide</option>\n          </select>\n          <select id=\"prioritySelect\">\n            <option value=\"all\" ${selectedPriority === \"all\" ? \"selected\" : \"\"}>All Priorities</option>\n            <option value=\"high\" ${selectedPriority === \"high\" ? \"selected\" : \"\"}>High</option>\n            <option value=\"medium\" ${selectedPriority === \"medium\" ? \"selected\" : \"\"}>Medium</option>\n            <option value=\"low\" ${selectedPriority === \"low\" ? \"selected\" : \"\"}>Low</option>\n            <option value=\"urgent\" ${selectedPriority === \"urgent\" ? \"selected\" : \"\"}>Urgent</option>\n          </select>\n          <input type=\"date\" id=\"startDateInput\" value=\"${startDate}\" />\n          <input type=\"date\" id=\"endDateInput\" value=\"${endDate}\" />\n          <select id=\"sortSelect\">\n            <option value=\"asc\" ${sortOrder === \"asc\" ? \"selected\" : \"\"}>Sort by Date (Asc)</option>\n            <option value=\"desc\" ${sortOrder === \"desc\" ? \"selected\" : \"\"}>Sort by Date (Desc)</option>\n          </select>\n        </div>\n        <div style=\"text-align: center; margin-top: 20px; margin-bottom: 20px;\">\n          <button id=\"alertBtn\" style=\"background: red; color: #fff; padding: 8px 16px; border: none; border-radius: 4px;\">\n            Cảnh báo Cộng Đồng\n          </button>\n        </div>\n        <div id=\"postListContainer\">\n          ${renderPostListHTML()}\n        </div>\n      </div>\n    `;\n    root.innerHTML = html;\n\n    // Gắn event listener\n    document.getElementById(\"searchInput\").addEventListener(\"input\", (e) => {\n      searchTerm = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"typeSelect\").addEventListener(\"change\", (e) => {\n      selectedType = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"prioritySelect\").addEventListener(\"change\", (e) => {\n      selectedPriority = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"startDateInput\").addEventListener(\"change\", (e) => {\n      startDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"endDateInput\").addEventListener(\"change\", (e) => {\n      endDate = e.target.value;\n      renderMainView();\n    });\n    document.getElementById(\"sortSelect\").addEventListener(\"change\", (e) => {\n      sortOrder = e.target.value;\n      renderMainView();\n    });\n\n    document.getElementById(\"alertBtn\").addEventListener(\"click\", () => {\n      appsmith.triggerEvent(\"navigateToPostForm\");\n    });\n\n    // Gắn listener cho nút Details\n    addDetailsListener();\n  }\n\n  // 9) Gọi fetchPosts\n  fetchPosts();\n});\n"
  },
  "version": 1,
  "widgetId": "wy3e6ciojj",
  "widgetName": "Custom1"
}